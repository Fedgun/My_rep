# Работа с базой данных из Python
*Ранее в курсе мы познакомились с основами SQL (язык запросов к базам данных) и Python (язык программирования). Возможно, у вас возникал вопрос: можно ли объединить два этих механизма? Можно ли работать с базами данных и выполнять SQL-запросы средствами Python? И если можно, то как это сделать?*

*В курсе для удобства работы с данными мы использовали Metabase. Однако Metabase — это не сама база данных, а [BI-инструмент](https://proglib.io/p/chto-takoe-bi-sistemy-i-zachem-oni-nuzhny-2021-05-10), то есть удобный интерфейс для взаимодействия с данными, которые хранятся в БД, построения отчётов и графиков. Всё это время наши данные хранились под управлением СУБД [PostgreSQL](https://blog.skillfactory.ru/glossary/postgresql/), а обращались мы к ним через запросы в Metabase.*

*В реальной деятельности дата-сайентисту требуется не только писать запрос к данным, но и затем обрабатывать его результаты с помощью Python. Для решения таких задач требуется некоторое средство, которое будет связывать Python и PostgreSQL так, чтобы мы могли с помощью Python отправлять запросы в Postgres и принимать оттуда результаты.*

*Именно таким средством является пакет [psycopg2](https://www.psycopg.org/docs/), о котором мы сейчас и поговорим.*

### Установка psycopg2

**Установить данный пакет на любой платформе можно одним способом — с помощью pip.*

*Запустите в отдельной ячейке Jupyter Notebook следующий код:*

***!pip install psycopg2***

*Если при установке возникает ошибка, похожая на “connection error: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:598)”, попробуйте установить пакет следующим образом:*

***!pip install --trusted-host pypi.org --trusted-host files.pythonhosted.org --trusted-host pypi.python.org psycopg2***

***Если всё прошло успешно, вы увидите сообщение, подобное этому:***

![alt text](image-1.png)

*Цифры могут отличаться, так как пакеты развиваются и номер их версии увеличивается.*

*Теперь посмотрим, как можно подключиться к нашей базе и выполнять запросы из Jupyter-ноутбука.*

***Для подключения нам потребуются следующие данные:***

- *dbname — название базы, к которой нужно подключиться;*
- *user — имя пользователя в СУБД;*
- *password — пароль;*
- *host — адрес, по которому нужно подключиться;*
- *port — порт, к которому нужно подключиться (по умолчанию равен 5432).*

***Для нашей базы эти параметры такие:***

DBNAME = 'skillfactory'
USER = 'skillfactory'
PASSWORD = 'cCkxxLVrDE8EbvjueeMedPKt'
HOST = '84.201.134.129'
PORT = 5432

***Python_and_SQL.ipynb*** *Ноутбук из скринкаста.*

### Настройки

*Начинаем с импорта библиотек:*

***import psycopg2
import pandas as pd***

*Создаём соединение с заданными параметрами:*

***connection = psycopg2.connect(
   dbname=DBNAME,
   user=USER,
   host=HOST,
   password=PASSWORD,
   port=PORT
)***

*Запрос:*

*код запроса представляет из себя строковую переменную*

***n = 10
query = f'''select *
           from sql.pokemon
           limit {n}
        '''***
*лучше использовать f-строки — так удобнее передавать параметры*

### Выполнение запроса

*используем метод read_sql_query, чтобы получить результаты запроса сразу в виде датафрейма*

***df = pd.read_sql_query(query, connection)
df***

### Финал

***не забываем закрыть соединение после окончания работы***
*connection.close()*